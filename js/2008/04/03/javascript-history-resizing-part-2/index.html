<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ghijklmno..</title>
    <meta name="description" content="The blog of Tom Morgan">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="//cloud.typography.com/6272452/793286/css/fonts.css" />
    <link rel="stylesheet" href="/css/styles.css">
    <!-- <script src="/js/modernizr.js"></script> -->
</head>
<body>
<header class="site-header" id="header">
        <h1 class="logo"><a href="/">Ghijklmno..</a></h1> 
        <p class="sub-heading">This is <a href="#">Tom Morgan</a>'s blog</p>
</header>
<main>
  
  <div class="main__content">
      <h1 class="post__title">Javascript, History, Resizing - Part 2</h1>
      <p class="post__date">&mdash;
                
        3rd
          
        April 2008 
      </p>
      <div class="post__content content"><!-- more -->




<p>As <a href="http://missinginactionscript.blogspot.com/2008/04/javascript-history-resizing-part-1.html">mentioned</a>. I wanted to create a Flash site which acted like a normal HTML website. Two things I found are a problem when it comes to this. Resizing &amp; History. (I dealt with Resizing in <a href="http://missinginactionscript.blogspot.com/2008/04/javascript-history-resizing-part-1.html">Part 1</a>) History = the Back button. Flash tends to miss it as a rule, sending users back to the last HTML page they were viewing. Generally you'd get around this by making the interactions in your Flash site intuitive enough that the user is never stuck with that "I wanna hit Back!" instinct, but sometimes that&#8217;s not the aim.</p>


<p><p>So we need to get the browser to record when a different "page" (i.e. set of content) is being viewed within the Flash site. Obviously it&#8217;s important at this stage to define, at least to yourself, what a different "page" is but that&#8217;s an interaction design issue and far too fuzzy to go into here. All we need to care about it that this is a "new page", when the user clicks the Back button they'll want to go back to what they saw before. How do we achieve that? Well it turns out that <code>ExternalInterface</code> is our friend here again although the solution this time is a little more complicated than before. Basically the HTML page hosting your swf needs to also include an iframe. Let&#8217;s call that iframe "history" and make it so tiny that&#8217;s it&#8217;s invisible.
<pre>&lt;iframe id=&quot;history&quot; name=&quot;history&quot; src=&quot;&quot; border=&quot;0&quot; height=&quot;0&quot; width=&quot;0&quot;&gt;&lt;/iframe&gt;</pre>
<p>What we do is load a new page in there each time we want to register a 'new page'in Flash. The browser thinks that it&#8217;s loaded a new page (well it has really) so hitting the back button simply reloads the previous page in the iframe. If we can get the iframe page to trigger the previous content in Flash we're laughing! So how do we do that? There are 3 things you must do.</p>
<ol>
    <li>Write a JavaScript function to pass the info into Flash.</li>
    <li>Write a ActionScript function to accept that info a display the right content.</li>
    <li>Write a JavaScript function (on each page you'll load into your iframe) that will call the function in 1. and pass info into the function in 2. telling Flash what content to display.</li>
</ol>
<h3>1. JavaScript</h3>
<pre>&lt;script&gt;
function setPage(newPage)
{
  var m = document.getElementById('something');
  m.sendToActionScript(newPage);
}
&lt;/script&gt;</pre>
<p>OK things to note: '<span style="font-weight: bold;">something</span>' is the id given to the object/embed tags used to put the flash content into your HTML. I covered the use of SWFObject for this <a href="http://missinginactionscript.blogspot.com/2008/04/javascript-history-resizing-part-1.html">before</a>. <b>sendToActionScript</b> is an arbitary name for the function, you'll see below that it could have been anything, but that name seems to make sense. <span style="font-weight: bold;">newPage </span>is the info we're sending to ActionScript about what content to display.</p>
<h3>2. ActionScript</h3>
<pre>if (ExternalInterface.available)
{
  ExternalInterface.addCallback('sendToActionScript', fromJavascript);
}</pre>
<p>This is where ActionScript picks up the fact that there's a function in JavaScript on your page called <b>sendToActionScript</b> and agrees to take some action when it is called. In fact it agrees to call another function called <b>fromJavascript</b> and pass whatever you&#8217;ve passed into the first, into the second.</p></p>

<p><pre>function fromJavascript(contentName){// do something with contentName}</pre>
<p>There's no point me telling you about <b>fromJavascript</b>. This will be an ActionScript function which will display the content. The only thing really to mention is that you're going to be passing something new into it each time the iframe is changed so you'll have to find some way to trigger the displaying of different content based on what&#8217;s passed in. It could simply be a <i>switch</i> statement or it could be much much more complicated. The decision is yours!3. JavaScript</p>
<pre>&lt;script&gt;parent.setPage(&#039;thispage&#039;);&lt;/script&gt;</pre>
<p>Right here's the magic. In each of the HTML pages you're going to drag into your iframe you'll need to have the above JavaScript. So each time the iframe loads another bit of content something similar will be run. The <b>parent</b> bit is talking about the HTML page containing the iframe. The HTML page which also contains your swf. The <b>setPage</b> bit is obviously the JavaScript function we&#8217;ve mentioned before, which is also sat in that page. Finally the <b>'thispage'</b> is the info we want to pass to Flash about what should be displaying. The thing which will eventually fall into the lap of your <b>fromJavascript</b> function in your flash movie. So how do we get all this up and running? Well the point with this is now that you have this system for dealing with user going 'Back' the way to make it work is to use it as the system for user going 'Forward'. So each time you load a new bit of content in your Flash (or at least a new bit you feel is worthy of being treated as a 'page') you should trigger it via the iframe. In order to do this you'll actually need 2 more bits of code.</p>
<ol start="4">
  <li>A JavaScript function to load a new page into the iframe</li>
  <li>A bit of ActionScript to trigger this function and pass in the page to load.</li>
</ol>
<h3>4. JavaScript</h3>
<pre>&lt;script&gt;function changeiFrame(url){var h = document.getElementById(&#039;history&#039;);h.src = url;}&lt;/script&gt;</pre>
<p>This simply takes a URL and loads it into the iframe. Simple as that.5. ActionScript
<pre>ExternalInterface.call('changeiFrame',url);</pre>This is what calls the above JavaScript from within Flash. And there you have it. When you want to change your content you call JavaScript, which changes the iframe, which calls some JavaScript, which calls some ActionScript which triggers the Flash content to change in some way. The problem with all this is obviously making the stuff which is passed around here unique enough to mean that the exact right bit of Flash is displayed each time. You'll need to take account of all the parameters which make your Flash content display a certain way and make sure that all that is able to be triggered through this mechanism. That&#8217;s not always easy, but it&#8217;s certainly far from impossible. BTW much of the above is taken from or at least inspired by the following list of websites. I hope I&#8217;ve added enough (making it specifically AS3, and explaining it in my own inimitable style) to warrant rehashing it here. As usual this is mainly for my own records and on the off-chance that someone else might find it useful.
"Shoulders of giants" I think is the phrase, 'twas always thus.</p>
<p><a href="http://www.robertpenner.com/experiments/backbutton/backbutton.html">penner</a><a href="http://www.contentwithstyle.co.uk/Articles/38/">stenhouse</a><a href="http://www.actionscript.org/resources/articles/142/1/Enabling-a-back-button-within-flash/Page1.html">hendershot</a></p></p>
</div>    
      <div class="post__nextprev cf">
         
          <a class="link prev" href="/2008/04/03/javascript-history-resizing-part-1/"><span class="icon-arrow-left"></span> Javascript, History, Resizing - Part 1</a> 
         
         
          <a class="link next" href="/2008/08/01/delicious/">Delicious <span class="icon-arrow-right"></span></a> 
         
      </div>
  </div>  

</main>

<p class="archive-link link"><a href="/archive/">Archive</a></p>

<!-- <script src="/js/all.min.js"></script> -->

<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. 
<script>
  (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
  function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
  e=o.createElement(i);r=o.getElementsByTagName(i)[0];
  e.src='//www.google-analytics.com/analytics.js';
  r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
  ga('create','UA-XXXXX-X');ga('send','pageview');
</script>
-->
<script type='text/javascript' id="__bs_script__">//<![CDATA[
document.write("<script async src='http://localhost:3000/browser-sync/browser-sync-client.2.0.0-rc3.js'><\/script>");
//]]></script>
</body>
</html>
